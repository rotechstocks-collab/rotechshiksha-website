You are a senior full-stack engineer + security auditor.

Project: Rotech Shiksha
Tech: React 18 + TypeScript + Vite + Tailwind + shadcn/ui + Wouter
Backend: Express + TypeScript
DB: Postgres (Neon) + Drizzle
Deploy: Replit

My codebase already exists and these files are important:
- server/routes.ts
- server/index.ts
- shared/schema.ts
- client/src/App.tsx

GOAL:
Fix all critical security and stability problems and make the app production-ready.

VERY IMPORTANT:
✅ You must provide COPY-PASTEABLE code patches with EXACT file paths.
✅ For each change, show:
  1) Where to paste (file path + section)
  2) Old code snippet (only relevant part)
  3) New code snippet (copy-paste ready)
  4) What to test after applying

DO NOT give generic advice. Implement real changes in the code.

----------------------------------------
TASK 1 (CRITICAL SECURITY FIXES) - MUST DO FIRST
----------------------------------------

1) REMOVE TEST OTP BACKDOOR
In server/routes.ts, there is a TEST_OTP fallback ("123456") which can be accepted during testing.
Fix it so that:
- In production: test OTP can NEVER work.
- Remove the default fallback value ("123456").
- Test OTP only works if:
  - NODE_ENV !== "production"
  - OTP_TEST_MODE === "true"
  - and mobile number is in a whitelist env variable (TEST_OTP_WHITELIST="9999999999,8888888888")
- If whitelist is missing, test OTP should NOT work.

2) FIX SESSION CONFIG (COOKIE SECURITY)
In server/routes.ts:
- Make SESSION_SECRET mandatory (no hardcoded fallback).
- If SESSION_SECRET missing -> server should throw startup error and stop.
- Session cookie must be:
  secure: (NODE_ENV === "production")
  httpOnly: true
  sameSite: "strict"
  maxAge: 30 days

3) ADD RATE LIMITING
Add express-rate-limit:
- Apply strict limiter on OTP routes:
  POST /api/auth/send-otp
  POST /api/auth/verify-otp
  POST /api/auth/resend-otp
  limit: max 5 requests per 15 minutes per IP
- Add a general limiter for all /api routes:
  max 200 requests per 15 min per IP

4) ADD CORS PROPERLY
Only allow these origins and enable credentials:
- https://rotechshiksha.com
- https://rotech-solutions--rotechstocks.replit.app
- http://localhost:5173 (dev)
Block all others.

5) ADD SECURITY HEADERS
Add helmet with a basic CSP:
- Prevent clickjacking
- Add X-Content-Type-Options
- Add Referrer-Policy
- Add basic Content-Security-Policy (safe for React/Vite)

----------------------------------------
TASK 2 (BACKEND STABILITY)
----------------------------------------

6) FIX ERROR HANDLER CRASH
In server/index.ts there is an error handler that does `throw err;`
Remove that throw so server doesn’t crash in production.
Log error properly.

----------------------------------------
TASK 3 (FRONTEND STABILITY + PERFORMANCE)
----------------------------------------

7) ADD ERROR BOUNDARY IN FRONTEND
Create a reusable ErrorBoundary component and wrap the App router so user does not see blank screen.
Show friendly UI + reload button.

8) ROUTE-BASED CODE SPLITTING
In client/src/App.tsx:
- Convert major routes to React.lazy + Suspense
- Provide a global loading UI (simple skeleton or spinner)
- Keep imports clean and working with Wouter

----------------------------------------
OUTPUT REQUIRED:
----------------------------------------

A) A table: "Fix | File | Risk | Estimated time"
B) For each task: copy-paste patch blocks file-wise
C) A final "Testing Checklist" with exact steps:
  - how to test OTP in prod vs dev
  - how to test cookies
  - how to test rate limiting
  - how to test CORS
  - how to test ErrorBoundary
D) A final list of required ENV variables and what values to set:
  SESSION_SECRET
  OTP_TEST_MODE
  TEST_OTP
  TEST_OTP_WHITELIST
  NODE_ENV
  CLIENT_URL / ALLOWED_ORIGINS (if you create it)

Start with TASK 1 and do not skip anything.
